/* JavaScript
 * Department of Permitting Services Complaint App
 *
 * initalise device module of complaint app namespace;
 * has functions for local storage, camera, and geolocation
 *
 * 01-05-2013 alisa.ky.chen@gmail.com */

// namespace() defined in mobile-complaint-app.js
COMPLAINTAPP.namespace("module.device");

/*** return object containing public API of device module ***/
// requires navigator from Cordova API and google from Google Maps API;
// also need to include the following lines in config.xml for PhoneGap Build
// <feature name="http://api.phonegap.com/1.0/device" />
// <feature name="http://api.phonegap.com/1.0/camera" />
// <feature name="http://api.phonegap.com/1.0/geolocation"/>
COMPLAINTAPP.module.device = (function (app, window, navigator) {
  /*** app module dependencies ***/

  /*** private properties ***/
  var camera = {},
  /*** private methods ***/
      /* initialise properties, dependent on Cordova navigator */
      onDeviceReady = function() {
        //storage = window.localStorage;
      },

      /* display message if geolocation method fails or is cancelled */
      showGeoErrorMsg = function (error) {
        alert(error.message);
      },

      /* get current position from device and pass position
       * to callback onSuccess; onFail is optional parameter */
      /* NOTE: position object has
       * Latitude:          position.coords.latitude
       * Longitude:         position.coords.longitude
       * Altitude:          position.coords.altitude
       * Accuracy:          position.coords.accuracy
       * Altitude Accuracy: position.coords.altitudeAccuracy
       * Heading:           position.coords.heading
       * Speed:             position.coords.speed
       * Timestamp:         position.timestamp */
      getCurrentPosition = function(onSuccess, onFail) {
        if (typeof onFail === "undefined") { onFail = showGeoErrorMsg; }

        // NOTE: waits for one minute before giving up on getting position;
        // Adobe's PhoneGap Build seems return the position faster than
        // the apk generated by the Eclipse emulator,
        // also enableHighAccuracy seems to make it faster, strangely
        navigator.geolocation.getCurrentPosition(onSuccess, onFail,
            { /*timeout: 60000, enableHighAccuracy: true*/ }
        );
      };

  /*** public API of device module ***/
  return {
    // properties
    storage: window.localStorage,
    // methods
    onDeviceReady: onDeviceReady,
    getCurrentPosition: getCurrentPosition
  };
}(COMPLAINTAPP, window, navigator));